#!/usr/bin/env zsh
#
# setopt.zsh - zshオプション設定
#
# zshの動作を制御する各種オプションを設定する。
# setopt でオプションを有効化、unsetopt または setopt no_<option> で無効化。
#

# ==============================================================================
# システム設定
# ==============================================================================

# /etc/zshrc等のグローバル設定ファイルの読み込みをスキップ
# 環境の一貫性を保つため、dotfilesの設定のみを使用
setopt no_global_rcs

# ==============================================================================
# ヒストリ設定
# ==============================================================================

# コマンド入力直後にヒストリファイルに追記（シェル終了を待たない）
# 複数ターミナル間でヒストリを即時共有
setopt inc_append_history

# ヒストリを複数のzshセッション間で共有
# 他のターミナルで実行したコマンドも即座に参照可能
setopt share_history

# タイムスタンプと実行時間をヒストリに記録
# 形式: ": <開始時刻>:<実行秒数>;<コマンド>"
setopt extended_history

# `history` コマンド自体はヒストリに残さない
setopt hist_no_store

# 関数定義はヒストリに残さない
setopt hist_no_functions

# ヒストリ検索時に重複を表示しない
setopt hist_find_no_dups

# スペースで始まるコマンドはヒストリに残さない
# 一時的に秘密のコマンドを実行したい場合に便利
setopt hist_ignore_space

# コマンドの余分な空白を除去してからヒストリに保存
setopt hist_reduce_blanks

# ヒストリ展開（!!, !$等）は即実行せず、展開結果を編集可能にする
setopt hist_verify

# ==============================================================================
# ディレクトリ操作
# ==============================================================================

# pushdで同じディレクトリを重複してスタックに積まない
setopt pushd_ignore_dups

# 引数なしのpushdは$HOMEに移動（cdと同じ動作）
setopt pushd_to_home

# ==============================================================================
# ジョブ制御
# ==============================================================================

# バックグラウンドジョブの状態変化を即座に通知
# プロンプト表示を待たずに完了/停止を報告
setopt notify

# jobsコマンドでPIDも表示（詳細な情報を提供）
setopt long_list_jobs

# ==============================================================================
# 入出力
# ==============================================================================

# echoコマンドをBSD互換モードに
# エスケープシーケンスは-eオプション指定時のみ解釈
setopt bsd_echo

# 8ビット文字（日本語等）を正しく表示
setopt print_eight_bit

# 終了ステータスが0以外のコマンドは終了コードを表示
setopt print_exit_value

# xtraceを無効化（デバッグ用のコマンド出力を抑制）
setopt no_xtrace

# ==============================================================================
# プロンプト設定
# ==============================================================================

# コマンド実行後に右プロンプト(RPROMPT)を消去
# コピペ時に邪魔にならない
setopt transient_rprompt

# プロンプト文字列内で変数展開・コマンド置換を有効化
setopt prompt_subst

# プロンプト表示前にキャリッジリターンを出力しない
setopt no_prompt_cr

# ==============================================================================
# 補完設定
# ==============================================================================

# 曖昧な補完で候補を自動的にリスト表示
setopt auto_list

# 2回目のTab押下から自動的にメニュー補完モードに入る
setopt auto_menu

# 補完後のスラッシュは、次の入力が区切り文字なら自動削除
setopt auto_remove_slash

# パラメータ名補完後、続く文字（}, :等）の前の自動挿入文字を削除
setopt auto_param_keys

# ディレクトリ名を含むパラメータ補完時、末尾にスラッシュを追加
setopt auto_param_slash

# 補完候補にファイルタイプを示すマーク（/, *, @等）を表示
setopt list_types

# 補完後は常に最後のプロンプト位置に戻る
setopt always_last_prompt

# ==============================================================================
# グロブ・パターンマッチング
# ==============================================================================

# グロブ（ファイル名展開）を有効化
setopt glob

# 拡張グロブを有効化（#, ~, ^をパターンとして使用可能）
# 例: ^*.txt（.txt以外）、**/*.js（再帰検索）
setopt extended_glob

# グロブで大文字小文字を区別しない
setopt no_case_glob

# ディレクトリにマッチした場合、末尾に/を付加
setopt mark_dirs

# スラッシュを含むコマンド名でもPATH検索を実行
setopt path_dirs

# `foo=~/bar` のような形式でもチルダ展開を実行
setopt magic_equal_subst

# ブレース展開を拡張（{a-z}で連続文字を展開）
setopt brace_ccl

# ==============================================================================
# コメント
# ==============================================================================

# インタラクティブシェルでも#以降をコメントとして扱う
# コマンドラインでメモを残したい場合に便利
setopt interactive_comments

# ==============================================================================
# ビープ音
# ==============================================================================

# ZLEでのエラー時にビープ音を鳴らさない
setopt no_beep

# 曖昧な補完時にビープ音を鳴らさない
setopt no_list_beep

# 存在しないヒストリにアクセス時にビープ音を鳴らさない
setopt no_hist_beep

# ==============================================================================
# 安全性
# ==============================================================================

# `rm *` や `rm path/*` 実行時、10秒間入力を無視して確認を促す
setopt rm_star_wait
